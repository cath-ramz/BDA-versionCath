{% extends "base.html" %}

{% block title %}Reportes - Sistema Joyería{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
<style>
    .reportes-container {
        padding: 2rem 0;
    }
    
    .report-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .report-section h2 {
        color: #2c3e50;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 3px solid #3498db;
    }
    
    .report-section h3 {
        color: #34495e;
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        font-size: 1.25rem;
    }
    
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .kpi-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .kpi-box.ventas {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .kpi-box.clientes {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .kpi-box.productos {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .kpi-box.devoluciones {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .kpi-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }
    
    .kpi-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .kpi-subtitle {
        font-size: 0.8rem;
        opacity: 0.8;
    }
    
    .chart-container {
        min-height: 400px;
        margin-bottom: 2rem;
    }
    
    .filter-controls {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }
    
    .filter-controls .form-group {
        margin-bottom: 0.5rem;
    }
    
    .table-report {
        margin-top: 1rem;
    }
    
    .table-report th {
        background: #34495e;
        color: white;
    }
    
    .badge-custom {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">
                    <i class="bi bi-graph-up-arrow"></i> Reportes y Análisis
                </h1>
                <p class="text-muted">Análisis detallado de ventas, inventario, clientes y más</p>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid reportes-container">
    <!-- KPIs Resumen -->
    <div class="report-section">
        <h2><i class="bi bi-speedometer2"></i> Resumen Ejecutivo</h2>
        <div class="kpi-grid" id="kpiResumen">
            <div class="kpi-box ventas">
                <div class="kpi-label">Ingresos Totales</div>
                <div class="kpi-value" id="kpiIngresosTotales">$0</div>
                <div class="kpi-subtitle" id="kpiIngresosSubtitle">En el período seleccionado</div>
            </div>
            <div class="kpi-box clientes">
                <div class="kpi-label">Total Pedidos</div>
                <div class="kpi-value" id="kpiTotalPedidos">0</div>
                <div class="kpi-subtitle" id="kpiPedidosSubtitle">Pedidos completados</div>
            </div>
            <div class="kpi-box productos">
                <div class="kpi-label">Ticket Promedio</div>
                <div class="kpi-value" id="kpiTicketPromedio">$0</div>
                <div class="kpi-subtitle">Por pedido</div>
            </div>
            <div class="kpi-box devoluciones">
                <div class="kpi-label">Tasa de Devolución</div>
                <div class="kpi-value" id="kpiTasaDevolucion">0%</div>
                <div class="kpi-subtitle">Devoluciones / Pedidos</div>
            </div>
        </div>
    </div>

    <!-- Ventas por Año -->
    <div class="report-section">
        <h2><i class="bi bi-calendar-year"></i> Análisis de Ventas por Año</h2>
        <div id="chartVentasMes" class="chart-container"></div>
    </div>

    <!-- Ventas por Categoría -->
    <div class="report-section">
        <h2><i class="bi bi-tags"></i> Ventas por Categoría</h2>
        <div class="row">
            <div class="col-md-6">
                <div id="chartVentasCategoria" class="chart-container"></div>
            </div>
            <div class="col-md-6">
                <div id="chartVentasCategoriaPie" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- Top Productos -->
    <div class="report-section">
        <h2><i class="bi bi-trophy"></i> Top Productos Más Vendidos</h2>
        <div class="row mb-3">
            <div class="col-md-3">
                <select id="topNProductos" class="form-select">
                    <option value="5" selected>Top 5</option>
                    <option value="10">Top 10</option>
                    <option value="20">Top 20</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-primary" onclick="cargarTopProductos()">
                    <i class="bi bi-arrow-clockwise"></i> Actualizar
                </button>
            </div>
        </div>
        <div id="chartTopProductos" class="chart-container"></div>
        <div id="tablaTopProductos" class="table-responsive mt-3"></div>
    </div>

    <!-- Análisis de Clientes -->
    <div class="report-section">
        <h2><i class="bi bi-people"></i> Análisis de Clientes</h2>
        <div class="row">
            <div class="col-md-6">
                <h3>Clientes Más Frecuentes</h3>
                <div id="tablaClientesFrecuentes" class="table-responsive"></div>
            </div>
            <div class="col-md-6">
                <h3>Clientes VIP (Mayor Gasto)</h3>
                <div id="tablaClientesVIP" class="table-responsive"></div>
            </div>
        </div>
    </div>

    <!-- Análisis de Devoluciones -->
    <div class="report-section">
        <h2><i class="bi bi-arrow-counterclockwise"></i> Análisis de Devoluciones</h2>
        <div class="row">
            <div class="col-md-6">
                <div id="chartDevolucionesMotivo" class="chart-container"></div>
            </div>
            <div class="col-md-6">
                <div id="chartDevolucionesTipo" class="chart-container"></div>
            </div>
        </div>
        <h3 class="mt-4">Devoluciones Recientes</h3>
        <div id="tablaDevoluciones" class="table-responsive mt-3"></div>
    </div>

    <!-- Análisis de Inventario -->
    <div class="report-section">
        <h2><i class="bi bi-box-seam"></i> Análisis de Inventario</h2>
        <div class="row">
            <div class="col-md-6">
                <h3>Productos con Bajo Stock</h3>
                <div id="tablaBajoStock" class="table-responsive"></div>
            </div>
            <div class="col-md-6">
                <h3>Productos Más Rentables</h3>
                <div id="tablaProductosRentables" class="table-responsive"></div>
            </div>
        </div>
    </div>

    <!-- Facturación Diaria -->
    <div class="report-section">
        <h2><i class="bi bi-graph-up"></i> Facturación Diaria</h2>
        <div id="chartFacturacionDiaria" class="chart-container"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="{{ url_for('static', filename='js/reportes.js') }}"></script>
{% endblock %}
